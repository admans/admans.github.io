---
layout: page
title: ä¸è´¥æˆ˜ç¥å‹¾å‹¾å†Œ
permalink: /pages/checklist_bubai.html
---

<style>
/* === æ ¸å¿ƒä¿®æ”¹ï¼šå¼ºåˆ¶çªç ´å…¨å±€å®½åº¦é™åˆ¶ === */
body {
    max-width: 98% !important;
    padding: 0 10px !important;
}

/* åŸºç¡€æ ·å¼ */
.checklist-container { max-width: 100%; margin-top: 20px; font-family: "Microsoft YaHei", sans-serif; }
.control-panel { margin-bottom: 20px; padding: 15px; background-color: #f5f5f5; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
.btn { padding: 8px 16px; background-color: #333; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; transition: background-color 0.2s; white-space: nowrap; }
.btn:hover { background-color: #555; }
.btn-danger { background-color: #d9534f; }
.btn-danger:hover { background-color: #c9302c; }

/* è¿›åº¦æ¡æ ·å¼ */
.global-progress-box { margin-bottom: 25px; background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #eaeaea; }
.total-progress-bar { width: 100%; height: 10px; background-color: #e0e0e0; border-radius: 5px; overflow: hidden; margin-top: 10px; }
.total-progress-fill { height: 100%; background-color: #4caf50; width: 0%; transition: width 0.3s ease; }

/* è¡¨æ ¼æ ·å¼ */
.table-responsive { overflow-x: auto; max-height: 85vh; overflow-y: auto; border: 1px solid #eaeaea; border-radius: 8px; background: #fff; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
.matrix-table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 600px; }
.matrix-table th, .matrix-table td { padding: 10px; border-bottom: 1px solid #f0f0f0; border-right: 1px solid #f9f9f9; vertical-align: middle; }

/* å®ŒæˆçŠ¶æ€ä¸é”å®šçŠ¶æ€ */
.task-done-cell { background-color: #d1e7dd !important; transition: background-color 0.3s; }
.cell-locked { background-color: #f9f9f9 !important; color: #ccc; cursor: not-allowed; position: relative; }
.cell-locked .counter-wrapper { opacity: 0.3; pointer-events: none; }
.lock-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; z-index: 5; }
.lock-icon { font-size: 18px; color: #999; cursor: help; }

/* è¡¨å¤´å›ºå®š */
.matrix-table th { background-color: #fafafa; font-weight: 600; text-align: center; min-width: 160px; position: sticky; top: 0; z-index: 10; box-shadow: 0 2px 2px -1px rgba(0,0,0,0.1); }
.matrix-table th:first-child, .matrix-table td:first-child { position: sticky; left: 0; background-color: #fff; z-index: 2; border-right: 2px solid #eaeaea; min-width: 240px; max-width: 320px; text-align: left; }
.matrix-table th:first-child { z-index: 20; background-color: #fafafa; }

/* åˆ†ç±»æ ‡é¢˜ */
.category-row td { background-color: #eeeeee; font-weight: bold; color: #333; padding: 8px 15px; text-align: left; border-top: 2px solid #ddd; }
.task-remark { font-size: 12px; color: #999; margin-top: 4px; font-weight: normal; line-height: 1.4; }

/* è®¡æ•°å™¨æ§ä»¶ */
.counter-wrapper { display: flex; align-items: center; justify-content: center; gap: 5px; }
.count-btn { width: 24px; height: 24px; border-radius: 4px; border: 1px solid #ddd; background: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #555; padding: 0; user-select: none; }
.count-btn:active { background-color: #e0e0e0; }
.count-btn:disabled { background-color: #eee; color: #ccc; cursor: not-allowed; }
.count-display { min-width: 30px; text-align: center; font-weight: bold; font-size: 14px; }
.status-done { color: #0f5132; }

/* è´¦å·è¡¨å¤´ */
.acc-header { display: flex; flex-direction: column; gap: 6px; align-items: center; }
.acc-name-input { text-align: center; font-weight: bold; font-size: 15px; border: 1px solid transparent; background: transparent; width: 100%; padding: 2px; }
.acc-name-input:focus { border-bottom: 1px solid #999; background: #fff; }
.acc-progress-bar { width: 100%; height: 4px; background: #eee; border-radius: 2px; overflow: hidden; }
.acc-progress-fill { height: 100%; background: #4caf50; width: 0%; transition: width 0.3s; }

@media screen and (max-width: 600px) { 
    .control-panel { flex-direction: column; align-items: stretch; } 
    .matrix-table { font-size: 13px; } 
    .count-btn { width: 20px; height: 20px; } 
}
</style>

<div class="checklist-container">
    <div style="margin-bottom: 15px;">
        <a href="/pages/checklist.html" style="font-size:14px; color:#666;">&lt; è¿”å›å‹¾å‹¾å†Œå¤§å…</a>
    </div>

    <div class="control-panel">
        <div>
            <h2 style="font-size: 20px; font-weight: bold;">ä¸è´¥æˆ˜ç¥å‹¾å‹¾å†Œ</h2>
        </div>
        <button class="btn" onclick="addAccount()">+ æ–°å¢è´¦å·</button>
    </div>

    <div class="global-progress-box">
        <div style="display:flex; justify-content:space-between; font-size:14px; font-weight:bold;">
            <span>æ‰€æœ‰è´¦å·æ€»è¿›åº¦</span>
            <span id="global-progress-text">0%</span>
        </div>
        <div class="total-progress-bar">
            <div id="global-progress-fill" class="total-progress-fill"></div>
        </div>
    </div>

    <div class="table-responsive">
        <table class="matrix-table" id="checklist-table"></table>
    </div>
</div>

<script>
// ================= é…ç½®åŒºåŸŸ =================

const STORAGE_KEY = 'checklist_data_bubai';

// === é¢œè‰²é…ç½®åŒºåŸŸ ===
const COLOR_TITLE_GREEN  = "#6CFB4B";   // ç»¿è‰²ç§°å·é¢œè‰²
const COLOR_TITLE_PURPLE = "#B22AE3";   // ç´«è‰²ç§°å·é¢œè‰²
const COLOR_TITLE_GOLD   = "black";     // ä¸è´¥æˆ˜ç¥ç§°å·é¢œè‰²

// è¾…åŠ©å‡½æ•°
const titleSpan = (text, color) => `<span style="color: ${color}; font-weight: bold; text-shadow: 0px 0px 1px rgba(0,0,0,0.1);">&lt;${text}&gt;</span>`;

// ================= ä»»åŠ¡å®šä¹‰ä¸ä¾èµ–å…³ç³» =================
// req: ['id1', 'id2'] è¡¨ç¤ºå¿…é¡»å®Œæˆ id1 å’Œ id2 (è¾¾åˆ°æœ€å¤§å€¼) æ‰èƒ½è§£é”å½“å‰ä»»åŠ¡

const TASK_TEMPLATE = [
    {
        category: "ç¬¬ä¸€é˜¶æ®µï¼šç™½è‰²ä»»åŠ¡ (ä¸€å…±40ä¸ªï¼Œæ¯ä¸ªåš10æ¬¡)",
        tasks: [
            { id: "w_1", name: "éº»è¡£å¤è‹", max: 10, remark: "æ²™ç›—å£«å…µ*75" },
            { id: "w_2", name: "å¯†æŸ¥éº»è¡£æ•™", max: 10, remark: "é“œçŸ¿*5, ç²—çš®*10, ç»†çº¿*10, æ™®é€šçš®*10" },
            { id: "w_3", name: "è®¡è¯±éº»è¡£", max: 10, remark: "æ²™ç›—åˆºå®¢*75" },
            { id: "w_4", name: "éº»è¡£ç¥çŸ³", max: 10, remark: "æŠ—æ²‰é»˜çŸ³*10, æŠ—ç¼“æ…¢çŸ³*10, æŠ—ç¡çœ çŸ³*10, YYç¥çŸ³*5" },
            { id: "w_5", name: "è ¢è ¢æ¬²åŠ¨çš„æ¢¨èŠ±æ•™", max: 10, remark: "æ²™ç›—å¥³å£«å…µ*75" },
            { id: "w_6", name: "æ¢¨èŠ±æ•™å¾’", max: 10, remark: "ç„è›‡ä¹‹çš®*50, é²›äººä¹‹æ³ª*50, éº»å¸ƒ*10, å‘½ä¸­çŸ³*5" },
            { id: "w_7", name: "å‹¾ç»“æ¢¨èŠ±", max: 10, remark: "æ²™ç›—å·«å¸ˆ*75" },
            { id: "w_8", name: "æ½œå…¥æ¢¨èŠ±æ•™", max: 10, remark: "æŠ—çœ©æ™•çŸ³*10, æŠ—ç¼ ç»•çŸ³*10, æŠ—è™šå¼±çŸ³*10, å†°æ™¶çŸ³*10" },
            { id: "w_9", name: "æ²‰å¯‚çš„ä¸å¸®", max: 10, remark: "æ²™ç›—ç»Ÿé¢†*75" },
            { id: "w_10", name: "ä¸å¸®çš„éœ€è¦", max: 10, remark: "æ°´ä¹‹æ™¶*5, é‡‘ä¹‹æ™¶*5, åœŸä¹‹æ™¶*5, æœ¨ä¹‹æ™¶*5" },
            { id: "w_11", name: "ä¸å¸®ç»æ€", max: 10, remark: "ä¿®ç½—éª‘å…µ*50" },
            { id: "w_12", name: "é‡æ•´ä¸å¸®", max: 10, remark: "é“çŸ¿*10, ç™½é‡‘çŸ¿*10, é¾™çš®*10, ç»¢å¸ƒ*10" },
            { id: "w_13", name: "ä¿é¾™çš„èºåŠ¨", max: 10, remark: "æ²™ç›—å¥³å£«å…µ*30, æ²™ç›—åˆºå®¢*50" },
            { id: "w_14", name: "ä¿é¾™çš„è®¡è°‹", max: 10, remark: "é‡‘ä¸*10, é¾™çš®*10, æ°´æ™¶*10, å¿…èƒœé˜æœˆé¥¼*5" },
            { id: "w_15", name: "ä¿é¾™å¯†å…¥é»‘æš—çš‡åŸ", max: 10, remark: "ä¿®ç½—æ­¥å…µ*50" },
            { id: "w_16", name: "è¯•æ¢ä¿é¾™", max: 10, remark: "æŠ—çœ©æ™•çŸ³*10, æŠ—ç¼ ç»•çŸ³*10, æŠ—ç¡çœ çŸ³*10, å‘½ä¸­çŸ³*5" },
            { id: "w_17", name: "æ­¦æ—ç›Ÿçš„è¡ŒåŠ¨", max: 10, remark: "æ²™ç›—å·«å¸ˆ*75" },
            { id: "w_18", name: "æ­¦æ—ç›Ÿçš„å›°æ‰°", max: 10, remark: "ç²—çš®*10, éº»å¸ƒ*10, ç»†çº¿*10, é“çŸ¿*10" },
            { id: "w_19", name: "æš—åŠ©æ­¦æ—ç›Ÿ", max: 10, remark: "æ²™é­”*75" },
            { id: "w_20", name: "æ­¦æ—ç›Ÿçš„æœ‹å‹", max: 10, remark: "æŠ—çœ©æ™•çŸ³*10, æŠ—ç¼“æ…¢çŸ³*10, æŠ—æ²‰é»˜çŸ³*10, è¯·ç¥ç¬¦(3å°æ—¶)*1" },
            { id: "w_21", name: "ç¥ç§˜çš„YYæ•™ä¸»", max: 10, remark: "æ²™ç›—éª‘å…µ*75" },
            { id: "w_22", name: "YYæ•™çš„è™”è¯šä¿¡å¾’", max: 10, remark: "æ¥šæµé¦™*50, YYæ•™ä¸»å®è®­*10, æŠ—æ²‰é»˜çŸ³*10, æ°´æ™¶*10" },
            { id: "w_23", name: "YYæ•™å¾’çš„è¡ŒåŠ¨", max: 10, remark: "ä¿®ç½—å¼“æ‰‹*50" },
            { id: "w_24", name: "æ— å¤„ä¸YY", max: 10, remark: "é¾™çš®*10, æ‰*10, é‡‘ä¸*10, æŠ—ç¡çœ çŸ³*10" },
            { id: "w_25", name: "äº”æ¯’æ•™è¢«ç–‘", max: 10, remark: "æ²™ç›—ç»Ÿé¢†*75" },
            { id: "w_26", name: "äº”æ¯’æ•£", max: 10, remark: "å†°æ™¶çŸ³*10, é»„ç‰*10, æ°´æ™¶*10, æŠ—çœ©æ™•çŸ³*10" },
            { id: "w_27", name: "æ€ªå¼‚çš„äº”æ¯’æ•™", max: 10, remark: "æ²™æ¼ å·¨çŸ³æ€ª*75" },
            { id: "w_28", name: "äº”æ¯’æ•™è´¢å®", max: 10, remark: "æ°´æ™¶*10, æŠ—ç¼ ç»•çŸ³*10, æŠ—è™šå¼±çŸ³*10, æŠ—ç¡çœ çŸ³*10" },
            { id: "w_29", name: "é­”æ•™éšé", max: 10, remark: "æ²™ç›—å·«å¸ˆ*75" },
            { id: "w_30", name: "é­”æ•™é•¿è€", max: 10, remark: "ç™½é‡‘çŸ¿*10, æ‰*10, é‡‘ä¸*10, é¾™çš®*10" },
            { id: "w_31", name: "é­”æ•™æˆ˜ä¿®ç½—", max: 10, remark: "ä¿®ç½—æ­¥å…µ*50" },
            { id: "w_32", name: "é­”æ•™é­”åŠŸ", max: 10, remark: "æŠ—çœ©æ™•çŸ³*10, æŠ—ç¼“æ…¢çŸ³*10, æŠ—ç¡çœ çŸ³*10, YYç¥çŸ³*5" },
            { id: "w_33", name: "å¹½çµå·è¢­", max: 10, remark: "æ²™ç›—ç»Ÿé¢†*75" },
            { id: "w_34", name: "å¹½çµç¥­å›", max: 10, remark: "ç»¢å¸ƒ*10, é“çŸ¿*10, é¾™çš®*10, ç²—çš®*10" },
            { id: "w_35", name: "åå‡»å¹½çµ", max: 10, remark: "æ²™é­”*75" },
            { id: "w_36", name: "å°å°å¹½çµ", max: 10, remark: "æŠ—çœ©æ™•çŸ³*10, æŠ—ç¡çœ çŸ³*10, æŠ—ç¼“æ…¢çŸ³*10, é—ªèº²çŸ³*10" },
            { id: "w_37", name: "äº¬é¾™è¿å¾™", max: 10, remark: "æ²™ç›—éª‘å…µ*75" },
            { id: "w_38", name: "äº¬é¾™ä¹‹äº‹", max: 10, remark: "æ°´æ™¶*20, é“ç ‚*20, æ ‘æ ¹*20, é»„ç‰*10" },
            { id: "w_39", name: "å¦ç±»äº¬é¾™å¸®", max: 10, remark: "æ²™ç›—ç»Ÿé¢†*75" },
            { id: "w_40", name: "äº¬é¾™å¸®åº†å…¸", max: 10, remark: "éº¦å¾—åŠ³*2, æ²¹çˆ†æ‡æ·*2, å¿…èƒœé˜*2, YYç¥çŸ³*5" }
        ]
    },
    {
        category: "ç¬¬äºŒé˜¶æ®µï¼šç»¿è‰²ç§°å·æ¿€æ´» (å„åš1æ¬¡)",
        tasks: [
            { id: "ga_1", req: ["w_1"], name: "éº»è¡£ä¹‹æœé¥°", max: 1, remark: "å‰ç½®: éº»è¡£å¤è‹*10" },
            { id: "ga_2", req: ["w_2"], name: "éº»è¡£ä¹‹äº‰ç«¯", max: 1, remark: "å‰ç½®: å¯†æŸ¥éº»è¡£æ•™*10" },
            { id: "ga_3", req: ["w_3"], name: "éº»è¡£ä¹‹çµçŸ³", max: 1, remark: "å‰ç½®: è®¡è¯±éº»è¡£*10" },
            { id: "ga_4", req: ["w_4"], name: "éº»è¡£ä¹‹è¾‰ç…Œ", max: 1, remark: "å‰ç½®: éº»è¡£ç¥çŸ³*10" },
            { id: "ga_5", req: ["w_5"], name: "æ¢¨èŠ±Â·æ•™å¾½", max: 1, remark: "å‰ç½®: è ¢è ¢æ¬²åŠ¨çš„æ¢¨èŠ±æ•™*10" },
            { id: "ga_6", req: ["w_6"], name: "æ¢¨èŠ±Â·é£˜é£˜", max: 1, remark: "å‰ç½®: æ¢¨èŠ±æ•™å¾’*10" },
            { id: "ga_7", req: ["w_7"], name: "æ¢¨èŠ±Â·æ™¶è¹", max: 1, remark: "å‰ç½®: å‹¾ç»“æ¢¨èŠ±*10" },
            { id: "ga_8", req: ["w_8"], name: "æ¢¨èŠ±Â·äº‰æ–—", max: 1, remark: "å‰ç½®: æ½œå…¥æ¢¨èŠ±æ•™*10" },
            { id: "ga_9", req: ["w_9"], name: "ä¸å¸®å‚¨å¤‡", max: 1, remark: "å‰ç½®: æ²‰å¯‚çš„ä¸å¸®*10" },
            { id: "ga_10", req: ["w_10"], name: "ä¸å¸®æ€æ•Œ", max: 1, remark: "å‰ç½®: ä¸å¸®çš„éœ€è¦*10" },
            { id: "ga_11", req: ["w_11"], name: "æ™¶çŸ³æ•‘ä¸å¸®", max: 1, remark: "å‰ç½®: ä¸å¸®ç»æ€*10" },
            { id: "ga_12", req: ["w_12"], name: "ä¸å¸®æ”»ä¿®ç½—", max: 1, remark: "å‰ç½®: é‡æ•´ä¸å¸®*10" },
            { id: "ga_13", req: ["w_13"], name: "ä¿é¾™ç¬¬ä¸€ç¾å¥³", max: 1, remark: "å‰ç½®: ä¿é¾™çš„èºåŠ¨*10" },
            { id: "ga_14", req: ["w_14"], name: "ä¿é¾™è¿½è¸ª", max: 1, remark: "å‰ç½®: ä¿é¾™çš„è®¡è°‹*10" },
            { id: "ga_15", req: ["w_15"], name: "é¾™æ—ä¼ è¯´", max: 1, remark: "å‰ç½®: ä¿é¾™å¯†å…¥é»‘æš—çš‡åŸ*10" },
            { id: "ga_16", req: ["w_16"], name: "ä¿é¾™ç¥åŠ›", max: 1, remark: "å‰ç½®: è¯•æ¢ä¿é¾™*10" },
            { id: "ga_17", req: ["w_17"], name: "æ­¦æ—ç›ŸèŠ‚æ—¥", max: 1, remark: "å‰ç½®: æ­¦æ—ç›Ÿçš„è¡ŒåŠ¨*10" },
            { id: "ga_18", req: ["w_18"], name: "æ­¦æ—ç›Ÿéƒ¨ç½²", max: 1, remark: "å‰ç½®: æ­¦æ—ç›Ÿçš„å›°æ‰°*10" },
            { id: "ga_19", req: ["w_19"], name: "æ­¦æ—ç›Ÿçš„äº”è¡Œæœ¯", max: 1, remark: "å‰ç½®: æš—åŠ©æ­¦æ—ç›Ÿ*10" },
            { id: "ga_20", req: ["w_20"], name: "æ­¦æ—ç›Ÿç¥å¼“", max: 1, remark: "å‰ç½®: æ­¦æ—ç›Ÿçš„æœ‹å‹*10" },
            { id: "ga_21", req: ["w_21"], name: "æ­è´ºYYæ•™ä¸»", max: 1, remark: "å‰ç½®: ç¥ç§˜çš„YYæ•™ä¸»*10" },
            { id: "ga_22", req: ["w_22"], name: "YYæ•™ä¸»é‡åˆº", max: 1, remark: "å‰ç½®: YYæ•™çš„è™”è¯šä¿¡å¾’*10" },
            { id: "ga_23", req: ["w_23"], name: "ç‚¼åˆ¶YYç¥çŸ³", max: 1, remark: "å‰ç½®: YYæ•™å¾’çš„è¡ŒåŠ¨*10" },
            { id: "ga_24", req: ["w_24"], name: "YYæ•™ç¥å¨", max: 1, remark: "å‰ç½®: æ— å¤„ä¸YY*10" },
            { id: "ga_25", req: ["w_25"], name: "äº”æ¯’æ•™çš„æ¯’ç‰©", max: 1, remark: "å‰ç½®: äº”æ¯’æ•™è¢«ç–‘*10" },
            { id: "ga_26", req: ["w_26"], name: "äº”æ¯’è¯åˆºå®¢", max: 1, remark: "å‰ç½®: äº”æ¯’æ•£*10" },
            { id: "ga_27", req: ["w_27"], name: "äº”æ¯’ç”ŸçƒŸ", max: 1, remark: "å‰ç½®: æ€ªå¼‚çš„äº”æ¯’æ•™*10" },
            { id: "ga_28", req: ["w_28"], name: "äº”æ¯’ç¢å·¨çŸ³", max: 1, remark: "å‰ç½®: äº”æ¯’æ•™è´¢å®*10" },
            { id: "ga_29", req: ["w_29"], name: "é­”æ•™é‡‡è´­", max: 1, remark: "å‰ç½®: é­”æ•™éšé*10" },
            { id: "ga_30", req: ["w_30"], name: "é­”æ•™æ–©æ²™ç›—", max: 1, remark: "å‰ç½®: é­”æ•™é•¿è€*10" },
            { id: "ga_31", req: ["w_31"], name: "é­”æ•™ç§˜æ€ä¿®ç½—", max: 1, remark: "å‰ç½®: é­”æ•™æˆ˜ä¿®ç½—*10" },
            { id: "ga_32", req: ["w_32"], name: "é­”æ•™çš„å‡†å¤‡", max: 1, remark: "å‰ç½®: é­”æ•™é­”åŠŸ*10" },
            { id: "ga_33", req: ["w_33"], name: "åŠ å›ºå¹½çµèˆ¹", max: 1, remark: "å‰ç½®: å¹½çµå·è¢­*10" },
            { id: "ga_34", req: ["w_34"], name: "å¹½çµé™„é­”", max: 1, remark: "å‰ç½®: å¹½çµç¥­å›*10" },
            { id: "ga_35", req: ["w_35"], name: "å¹½çµèˆ¹çš„ç„æœº", max: 1, remark: "å‰ç½®: åå‡»å¹½çµ*10" },
            { id: "ga_36", req: ["w_36"], name: "å¹½çµé€†è¢­", max: 1, remark: "å‰ç½®: å°å°å¹½çµ*10" },
            { id: "ga_37", req: ["w_37"], name: "äº¬é¾™å¸®çš„è°‹åˆ’", max: 1, remark: "å‰ç½®: äº¬é¾™è¿å¾™*10" },
            { id: "ga_38", req: ["w_38"], name: "äº¬é¾™æŒ‘è¡…æ²™ç›—", max: 1, remark: "å‰ç½®: äº¬é¾™ä¹‹äº‹*10" },
            { id: "ga_39", req: ["w_39"], name: "æ”¶ä¹°äº¬é¾™å¸®", max: 1, remark: "å‰ç½®: å¦ç±»äº¬é¾™å¸®*10" },
            { id: "ga_40", req: ["w_40"], name: "äº¬é¾™å± æ²™", max: 1, remark: "å‰ç½®: äº¬é¾™å¸®åº†å…¸*10" }
        ]
    },
    {
        category: "ç¬¬ä¸‰é˜¶æ®µï¼šç»¿è‰²ç§°å·ä»»åŠ¡ (å„åš1æ¬¡)",
        tasks: [
            { id: "gt_1", req: ["ga_1","ga_2","ga_3","ga_4"], name: `é¼ç›› ${titleSpan('å†³æˆ˜ä¹éœ„', COLOR_TITLE_GREEN)}`, max: 1, remark: "" },
            { id: "gt_2", req: ["ga_5","ga_6","ga_7","ga_8"], name: `çƒ¦å¿§ ${titleSpan('ç½„å£°æ‚ æ‚ ', COLOR_TITLE_GREEN)}`, max: 1, remark: "" },
            { id: "gt_3", req: ["ga_9","ga_10","ga_11","ga_12"], name: `ä»‡æ€ ${titleSpan('æƒŠå¤©åŠ¨åœ°', COLOR_TITLE_GREEN)}`, max: 1, remark: "" },
            { id: "gt_4", req: ["ga_13","ga_14","ga_15","ga_16"], name: `ç§˜é—» ${titleSpan('ç›´ä¸Šäº‘å¤©', COLOR_TITLE_GREEN)}`, max: 1, remark: "" },
            { id: "gt_5", req: ["ga_17","ga_18","ga_19","ga_20"], name: `é¾™è…¾ ${titleSpan('éœ¸ç‹ä¹‹æ°”', COLOR_TITLE_GREEN)}`, max: 1, remark: "" },
            { id: "gt_6", req: ["ga_21","ga_22","ga_23","ga_24"], name: `å¯†è°‹ ${titleSpan('å­¤å²›ç´éŸ³', COLOR_TITLE_GREEN)}`, max: 1, remark: "" },
            { id: "gt_7", req: ["ga_25","ga_26","ga_27","ga_28"], name: `æ€æœº ${titleSpan('ç›˜æ—‹ä¹å¤©', COLOR_TITLE_GREEN)}`, max: 1, remark: "" },
            { id: "gt_8", req: ["ga_29","ga_30","ga_31","ga_32"], name: `è™«æ¯’ ${titleSpan('æ— æ•Œçš„å¯‚å¯', COLOR_TITLE_GREEN)}`, max: 1, remark: "" },
            { id: "gt_9", req: ["ga_33","ga_34","ga_35","ga_36"], name: `é­”é­‚é™„ä½“ ${titleSpan('ç‰é¢è¾¾æ‘©', COLOR_TITLE_GREEN)}`, max: 1, remark: "" },
            { id: "gt_10", req: ["ga_37","ga_38","ga_39","ga_40"], name: `å¤™æ„¿ ${titleSpan('å¦‚æ²æ˜¥é£', COLOR_TITLE_GREEN)}`, max: 1, remark: "" }
        ]
    },
    {
        category: "ç¬¬å››é˜¶æ®µï¼šç»¿è‰²ä»»åŠ¡ (å„åš5æ¬¡)",
        tasks: [
            { id: "g_1", req: ["gt_1"], name: "æ¢¦ä¸­çš„éº»è¡£åœ£å¥³", max: 5, remark: `éœ€è¦: ${titleSpan('å†³æˆ˜ä¹éœ„', COLOR_TITLE_GREEN)}` },
            { id: "g_2", req: ["gt_2"], name: "æ¢¨èŠ±æ‚”æ‚Ÿ", max: 5, remark: `éœ€è¦: ${titleSpan('ç½„å£°æ‚ æ‚ ', COLOR_TITLE_GREEN)}` },
            { id: "g_3", req: ["gt_3"], name: "äº¬é¾™å¸®ç–‘æ¡ˆ", max: 5, remark: `éœ€è¦: ${titleSpan('æƒŠå¤©åŠ¨åœ°', COLOR_TITLE_GREEN)}` },
            { id: "g_4", req: ["gt_4"], name: "ä¸å¸®çš„ç»æµå±æœº", max: 5, remark: `éœ€è¦: ${titleSpan('ç›´ä¸Šäº‘å¤©', COLOR_TITLE_GREEN)}` },
            { id: "g_5", req: ["gt_4"], name: "ä¿é¾™ä¸€æ—çš„ç§˜å¯†", max: 5, remark: `éœ€è¦: ${titleSpan('ç›´ä¸Šäº‘å¤©', COLOR_TITLE_GREEN)}` },
            { id: "g_6", req: ["gt_5"], name: "æ­¦æ—ç›Ÿåœ£ç‰©", max: 5, remark: `éœ€è¦: ${titleSpan('éœ¸ç‹ä¹‹æ°”', COLOR_TITLE_GREEN)}` },
            { id: "g_7", req: ["gt_6"], name: "YYæˆ˜æ³•", max: 5, remark: `éœ€è¦: ${titleSpan('å­¤å²›ç´éŸ³', COLOR_TITLE_GREEN)}` },
            { id: "g_8", req: ["gt_8"], name: "äº”æ¯’æ•£é…æ–¹", max: 5, remark: `éœ€è¦: ${titleSpan('æ— æ•Œçš„å¯‚å¯', COLOR_TITLE_GREEN)}` },
            { id: "g_9", req: ["gt_9"], name: "é­”æ•™çªè¢­å¹½çµèˆ¹", max: 5, remark: `éœ€è¦: ${titleSpan('ç‰é¢è¾¾æ‘©', COLOR_TITLE_GREEN)}` },
            { id: "g_10", req: ["gt_10"], name: "å¹½çµä¹Ÿç–¯ç‹‚", max: 5, remark: `éœ€è¦: ${titleSpan('å¦‚æ²æ˜¥é£', COLOR_TITLE_GREEN)}` }
        ]
    },
    {
        category: "ç¬¬äº”é˜¶æ®µï¼šç´«è‰²ç§°å·æ¿€æ´» (å„åš1æ¬¡)",
        tasks: [
            { id: "pa_1", req: ["g_1"], name: "éº»è¡£æ•™æ€ªèŠ‚", max: 1, remark: "å‰ç½®: æ¢¦ä¸­çš„éº»è¡£åœ£å¥³*5" },
            { id: "pa_2", req: ["g_2"], name: "æ¢¨èŠ±å†ç°", max: 1, remark: "å‰ç½®: æ¢¨èŠ±æ‚”æ‚Ÿ*5" },
            { id: "pa_3", req: ["g_3"], name: "äº¬é¾™çš„æ”¶è—", max: 1, remark: "å‰ç½®: äº¬é¾™å¸®ç–‘æ¡ˆ*5" },
            { id: "pa_4", req: ["g_4"], name: "ä¸å¸®ä¹‹å¨", max: 1, remark: "å‰ç½®: ä¸å¸®çš„ç»æµå±æœº*5" },
            { id: "pa_5", req: ["g_5"], name: "ä¿é¾™æ—é¾™é­‚", max: 1, remark: "å‰ç½®: ä¿é¾™ä¸€æ—çš„ç§˜å¯†*5" },
            { id: "pa_6", req: ["g_6"], name: "æ­¦æ—ç›Ÿä¹‹æ€æ°”", max: 1, remark: "å‰ç½®: æ­¦æ—ç›Ÿåœ£ç‰©*5" },
            { id: "pa_7", req: ["g_7"], name: "YYæ•™ä¹‹ç¥çŸ³", max: 1, remark: "å‰ç½®: YYæˆ˜æ³•*5" },
            { id: "pa_8", req: ["g_8"], name: "äº”æ¯’æ˜¾å¨", max: 1, remark: "å‰ç½®: äº”æ¯’æ•£é…æ–¹*5" },
            { id: "pa_9", req: ["g_9"], name: "å¤šå˜é­”æ•™", max: 1, remark: "å‰ç½®: é­”æ•™çªè¢­å¹½çµèˆ¹*5" },
            { id: "pa_10", req: ["g_10"], name: "ç­æ€å¹½çµ", max: 1, remark: "å‰ç½®: å¹½çµä¹Ÿç–¯ç‹‚*5" }
        ]
    },
    {
        category: "ç¬¬å…­é˜¶æ®µï¼šç´«è‰²ç§°å·ä»»åŠ¡ (å„åš1æ¬¡)",
        tasks: [
            { id: "pt_1", req: ["pa_6","pa_8"], name: `æ·¡ç„¶ ${titleSpan('æ“å¤©ç‰æŸ±', COLOR_TITLE_PURPLE)}`, max: 1, remark: "å‰ç½®: æ­¦æ—ç›Ÿä¹‹æ€æ°”+äº”æ¯’æ˜¾å¨" },
            { id: "pt_2", req: ["pa_1","pa_4"], name: `ç‹‚æ€ ${titleSpan('æˆ˜ä¹‹é›„é­‚', COLOR_TITLE_PURPLE)}`, max: 1, remark: "å‰ç½®: éº»è¡£æ•™æ€ªèŠ‚+ä¸å¸®ä¹‹å¨" },
            { id: "pt_3", req: ["pa_2","pa_7"], name: `æ™¶é­‚ ${titleSpan('å‰‘èƒ†ç´å¿ƒ', COLOR_TITLE_PURPLE)}`, max: 1, remark: "å‰ç½®: æ¢¨èŠ±å†ç°+YYæ•™ä¹‹ç¥çŸ³" },
            { id: "pt_4", req: ["pa_3","pa_5"], name: `é£é¾™åˆç° ${titleSpan('é—¹æµ·é‡‘é¾™', COLOR_TITLE_PURPLE)}`, max: 1, remark: "å‰ç½®: äº¬é¾™çš„æ”¶è—+ä¿é¾™æ—é¾™é­‚" },
            { id: "pt_5", req: ["pa_9","pa_10"], name: `ä¼ºæœºè€ŒåŠ¨ ${titleSpan('ç»å‘½ç¥å·', COLOR_TITLE_PURPLE)}`, max: 1, remark: "å‰ç½®: å¤šå˜é­”æ•™+ç­æ€å¹½çµ" }
        ]
    },
    {
        category: "ç¬¬ä¸ƒé˜¶æ®µï¼šç´«è‰²ä»»åŠ¡ (å„åš5æ¬¡)",
        tasks: [
            { id: "p_1", req: ["pt_4"], name: "ä¿é¾™çƒ­è¡€", max: 5, remark: `éœ€è¦: ${titleSpan('é—¹æµ·é‡‘é¾™', COLOR_TITLE_PURPLE)}` },
            { id: "p_2", req: ["pt_1"], name: "æ­¦æ—ç›Ÿçš„å†³å®š", max: 5, remark: `éœ€è¦: ${titleSpan('æ“å¤©ç‰æŸ±', COLOR_TITLE_PURPLE)}` },
            { id: "p_3", req: ["pt_2"], name: "éº»è¡£ä¹‹æ€’", max: 5, remark: `éœ€è¦: ${titleSpan('æˆ˜ä¹‹é›„é­‚', COLOR_TITLE_PURPLE)}` },
            { id: "p_4", req: ["pt_5"], name: "é­”æ•™å†å…¥å¹½çµèˆ¹", max: 5, remark: `éœ€è¦: ${titleSpan('ç»å‘½ç¥å·', COLOR_TITLE_PURPLE)}` },
            { id: "p_5", req: ["pt_3"], name: "YYæ•™ä¸»é™ä¸´", max: 5, remark: `éœ€è¦: ${titleSpan('å‰‘èƒ†ç´å¿ƒ', COLOR_TITLE_PURPLE)}` }
        ]
    },
    {
        category: "ç¬¬å…«é˜¶æ®µï¼šä¸è´¥ç§°å·æ¿€æ´» (å„åš1æ¬¡)",
        tasks: [
            { id: "ua_1", req: ["p_3"], name: "éº»è¡£æƒ¹éº»çƒ¦", max: 1, remark: "å‰ç½®: éº»è¡£ä¹‹æ€’*5" },
            { id: "ua_2", req: ["p_2"], name: "æ­¦æ—ç›Ÿå¤ºèˆ¹", max: 1, remark: "å‰ç½®: æ­¦æ—ç›Ÿçš„å†³å®š*5" },
            { id: "ua_3", req: ["p_5"], name: "YYå¹½çµèˆ¹", max: 1, remark: "å‰ç½®: YYæ•™ä¸»é™ä¸´*5" },
            { id: "ua_4", req: ["p_1"], name: "ä¿é¾™æˆ˜å¹½çµ", max: 1, remark: "å‰ç½®: ä¿é¾™çƒ­è¡€*5" },
            { id: "ua_5", req: ["p_4"], name: "é­”æ•™VSå¹½çµ", max: 1, remark: "å‰ç½®: é­”æ•™å†å…¥å¹½çµèˆ¹*5" }
        ]
    },
    {
        category: "ç¬¬ä¹é˜¶æ®µï¼šä¸è´¥æˆ˜ç¥ (å„åš1æ¬¡)",
        tasks: [
            { id: "u_1", req: ["ua_1","ua_2","ua_3","ua_4","ua_5"], name: `è£èª‰ ${titleSpan('ä¸è´¥æˆ˜ç¥', COLOR_TITLE_GOLD)}`, max: 1, remark: "é›†é½5ä¸ªæ¿€æ´»ä»»åŠ¡" }
        ]
    }
];

// ============================================
// å¿«é€ŸæŸ¥æ‰¾è¡¨ï¼Œç”¨äºåæŸ¥ä»»åŠ¡è¯¦æƒ…
const ID_MAP = {};
TASK_TEMPLATE.forEach(cat => cat.tasks.forEach(t => ID_MAP[t.id] = t));

let accounts = [];
document.addEventListener('DOMContentLoaded', () => { loadData(); if (accounts.length === 0) { addAccount("ä¸»è´¦å·"); } else { render(); } });
function loadData() { const data = localStorage.getItem(STORAGE_KEY); if (data) { try { accounts = JSON.parse(data); } catch (e) { accounts = []; } } }
function saveData() { localStorage.setItem(STORAGE_KEY, JSON.stringify(accounts)); render(); }
function addAccount(name = "æ–°è´¦å·") { const newAccount = { id: Date.now().toString(), name: name, progress: {} }; accounts.push(newAccount); saveData(); }
function removeAccount(id) { if(confirm("ç¡®å®šåˆ é™¤è¯¥è´¦å·åŠå…¶æ‰€æœ‰è¿›åº¦å—ï¼Ÿ")) { accounts = accounts.filter(acc => acc.id !== id); saveData(); } }
function updateName(id, newName) { const acc = accounts.find(a => a.id === id); if (acc) { acc.name = newName; localStorage.setItem(STORAGE_KEY, JSON.stringify(accounts)); } }

// æ£€æŸ¥ä»»åŠ¡ä¾èµ–æ˜¯å¦æ»¡è¶³
function checkRequirements(acc, taskId) {
    const task = ID_MAP[taskId];
    if (!task || !task.req || task.req.length === 0) return { locked: false };

    for (let reqId of task.req) {
        const reqTask = ID_MAP[reqId];
        const prog = acc.progress[reqId] || 0;
        if (prog < reqTask.max) {
            // å»æ‰HTMLæ ‡ç­¾è·å–çº¯æ–‡æœ¬åå­—ç”¨äºæç¤º
            const tmpDiv = document.createElement("div");
            tmpDiv.innerHTML = reqTask.name;
            return { locked: true, missing: tmpDiv.innerText.trim() };
        }
    }
    return { locked: false };
}

function updateCount(accId, taskId, delta, max) { 
    const acc = accounts.find(a => a.id === accId);
    if (!acc) return;
    
    // æ£€æŸ¥é”å®š
    const status = checkRequirements(acc, taskId);
    if (status.locked) {
        alert(`ğŸ”’ ä»»åŠ¡é”å®š\nè¯·å…ˆå®Œæˆå‰ç½®ä»»åŠ¡ï¼š${status.missing}`);
        return;
    }

    if (!acc.progress[taskId]) acc.progress[taskId] = 0; 
    let newVal = acc.progress[taskId] + delta; 
    if (newVal < 0) newVal = 0; 
    if (newVal > max) newVal = max; 
    acc.progress[taskId] = newVal; 
    
    saveData();
}

function calculateProgress(acc) { 
    let max = 0, current = 0; 
    TASK_TEMPLATE.forEach(cat => { 
        cat.tasks.forEach(task => { 
            max += task.max; 
            current += (acc.progress[task.id] || 0); 
        }); 
    }); 
    const pct = max === 0 ? 0 : Math.round((current / max) * 100); 
    return { current, max, pct }; 
}

function updateProgressUI() { 
    let globalTotal = 0, globalMax = 0; 
    accounts.forEach(acc => { 
        const stats = calculateProgress(acc); 
        globalTotal += stats.current; 
        globalMax += stats.max; 
        const headPct = document.getElementById(`head-pct-${acc.id}`); 
        const headBar = document.getElementById(`head-bar-${acc.id}`); 
        if(headPct) headPct.innerText = `${stats.pct}%`; 
        if(headBar) headBar.style.width = `${stats.pct}%`; 
    }); 
    const gPct = globalMax === 0 ? 0 : Math.round((globalTotal / globalMax) * 100); 
    const globalText = document.getElementById('global-progress-text'); 
    const globalFill = document.getElementById('global-progress-fill'); 
    if(globalText) globalText.innerText = `${gPct}%`; 
    if(globalFill) globalFill.style.width = `${gPct}%`; 
}

function render() { 
    const table = document.getElementById('checklist-table'); 
    let theadHtml = `<thead><tr><th>ä»»åŠ¡å†…å®¹</th>${accounts.map(acc => { 
        const stats = calculateProgress(acc); 
        return `<th><div class="acc-header"><input class="acc-name-input" value="${acc.name}" onchange="updateName('${acc.id}', this.value)" placeholder="è´¦å·å"><div style="width:100%; display:flex; justify-content:space-between; font-size:12px; color:#666;"><span id="head-pct-${acc.id}">${stats.pct}%</span><span style="cursor:pointer; color:#d9534f;" onclick="removeAccount('${acc.id}')">åˆ é™¤</span></div><div class="acc-progress-bar"><div id="head-bar-${acc.id}" class="acc-progress-fill" style="width:${stats.pct}%"></div></div></div></th>`; 
    }).join('')}</tr></thead>`; 
    
    let tbodyHtml = '<tbody>'; 
    
    TASK_TEMPLATE.forEach((cat) => { 
        tbodyHtml += `<tr class="category-row"><td colspan="${accounts.length + 1}">${cat.category}</td></tr>`; 
        
        cat.tasks.forEach(task => { 
            tbodyHtml += `<tr><td><div style="font-weight:bold;">${task.name}</div>${task.remark ? `<div class="task-remark">${task.remark}</div>` : ''}</td>${accounts.map(acc => { 
                const val = acc.progress[task.id] || 0; 
                const isDone = val >= task.max; 
                
                // æ ¸å¿ƒé€»è¾‘ï¼šæ£€æŸ¥å‰ç½®ä»»åŠ¡
                const status = checkRequirements(acc, task.id);

                if (status.locked) {
                    // é”å®šçŠ¶æ€æ˜¾ç¤º
                    return `<td class="cell-locked" title="éœ€è¦å‰ç½®ï¼š${status.missing}">
                        <div class="lock-overlay"><span class="lock-icon" onclick="alert('ğŸ”’ ä»»åŠ¡é”å®š\\nè¯·å…ˆå®Œæˆå‰ç½®ä»»åŠ¡ï¼š${status.missing}')">ğŸ”’</span></div>
                        <div class="counter-wrapper"><button class="count-btn" disabled>-</button><div><div class="count-display">0</div></div><button class="count-btn" disabled>+</button></div>
                    </td>`;
                }

                return `<td id="cell-${acc.id}-${task.id}" class="${isDone ? 'task-done-cell' : ''}"><div class="counter-wrapper"><button class="count-btn" onclick="updateCount('${acc.id}', '${task.id}', -1, ${task.max})">-</button><div><div id="cnt-${acc.id}-${task.id}" class="count-display ${isDone ? 'status-done' : ''}">${val}</div></div><button class="count-btn" onclick="updateCount('${acc.id}', '${task.id}', 1, ${task.max})">+</button></div></td>`; 
            }).join('')}</tr>`; 
        }); 
    }); 
    
    tbodyHtml += '</tbody>'; 
    table.innerHTML = theadHtml + tbodyHtml; 
    updateProgressUI(); 
}
</script>