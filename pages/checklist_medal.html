<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è£èª‰å‹‹ç« å‹¾å‹¾å†Œ (å®šåˆ¶æè¿°ç‰ˆ)</title>
    <style>
        /* === åŸºç¡€æ ·å¼ === */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0 10px !important;
            max-width: 98% !important;
        }

        .checklist-container { max-width: 100%; margin-top: 20px; }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            background-color: #333;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        .btn:hover { background-color: #555; }
        .btn-danger { color: #d9534f; background: none; padding: 2px 6px; border: 1px solid #eee; font-size: 12px; }
        .btn-danger:hover { background: #ffebee; border-color: #d9534f; }

        /* === çŸ©é˜µè¡¨æ ¼ === */
        .table-responsive {
            overflow-x: auto;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid #eaeaea;
            border-radius: 8px;
            background: #fff;
            position: relative;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .matrix-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 950px;
        }

        .matrix-table th, .matrix-table td {
            padding: 8px 10px;
            border-bottom: 1px solid #f0f0f0;
            border-right: 1px solid #f9f9f9;
            vertical-align: middle;
        }

        /* å†»ç»“è¡¨å¤´å’Œé¦–åˆ— */
        .matrix-table th {
            background-color: #fafafa;
            font-weight: 600;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 2px -1px rgba(0,0,0,0.1);
        }
        
        .matrix-table th:first-child, 
        .matrix-table td:first-child {
            position: sticky;
            left: 0;
            background-color: #fff;
            z-index: 20;
            border-right: 2px solid #eaeaea;
            min-width: 260px;
            max-width: 320px;
            text-align: left;
        }
        .matrix-table th:first-child { z-index: 30; background-color: #fafafa; }

        .group-header td {
            background-color: #e3f2fd;
            font-weight: bold;
            color: #1565c0;
            padding: 10px 15px;
            text-align: left;
        }

        /* === å†…å®¹æ’ç‰ˆ === */
        .task-name { font-weight: bold; color: #333; display: block; font-size: 14px; margin-bottom: 4px; }
        
        .attr-badge {
            display: inline-block;
            background-color: #e1f5fe;
            color: #0277bd;
            font-size: 11px;
            padding: 3px 6px;
            border-radius: 4px;
            margin-bottom: 6px;
            line-height: 1.4;
            border: 1px solid #b3e5fc;
        }
        .attr-badge.dimmed { background: #f5f5f5; color: #999; border-color: #eee; }

        .task-desc { font-size: 12px; color: #555; display: block; margin-top: 2px; }
        .task-meta { font-size: 11px; color: #999; display: block; margin-top: 4px; }

        /* === äº¤äº’ç»„ä»¶æ ·å¼ === */
        .counter-wrapper {
            display: flex; align-items: center; justify-content: center; gap: 4px; margin: 2px 0;
        }
        .count-btn {
            width: 24px; height: 24px;
            border-radius: 4px; border: 1px solid #ddd;
            background: #fff; color: #555;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            padding: 0; user-select: none;
        }
        .count-btn:active { background-color: #e0e0e0; }
        .count-input {
            width: 40px; text-align: center; font-weight: bold; font-size: 14px;
            border: 1px solid transparent; background: transparent; padding: 0;
        }
        .count-input:focus { border-bottom: 1px solid #4caf50; outline: none; background: #fff; }
        .count-input.small-input { width: 30px; font-size: 11px; font-weight: normal; color: #888; border-bottom: 1px dotted #ddd; }
        
        .big-checkbox-wrapper {
            display: flex; align-items: center; justify-content: center;
            padding: 5px; cursor: pointer; border-radius: 4px;
            transition: background 0.2s; border: 1px dashed #ddd;
        }
        .big-checkbox-wrapper:hover { background-color: #f0f0f0; }
        .big-checkbox-wrapper input { transform: scale(1.3); cursor: pointer; margin-right: 6px; }
        .big-checkbox-text { font-size: 12px; color: #555; }
        .done-text { color: #2e7d32; font-weight: bold; text-decoration: none; }
        
        .or-divider { font-size: 10px; color: #999; text-align: center; margin: 6px 0; font-weight: bold; }

        .status-done { color: #2e7d32; font-weight: bold; }

        /* å•å…ƒæ ¼å¸ƒå±€ */
        .cell-section { margin: 5px 0; }
        .cell-label { 
            display: block; 
            font-size: 11px; 
            color: #555; 
            margin-bottom: 3px; 
            text-align: center; 
            line-height: 1.3;
            white-space: normal;
            font-weight: 500;
        }
        
        .divider { height: 1px; background: #eee; margin: 4px 0; }

        /* è¡ŒçŠ¶æ€ */
        .row-active { background-color: #e8f5e9 !important; border-left: 4px solid #4caf50; }
        .row-pending { background-color: #fff8e1 !important; border-left: 4px solid #ffc107; }
        
        .checkbox-area {
            display: flex; align-items: center; justify-content: center; gap: 6px;
            cursor: pointer; padding: 4px; border-radius: 4px; transition: background 0.2s;
        }
        .checkbox-area:hover { background-color: #f5f5f5; }
        .checkbox-area input[type="checkbox"] { transform: scale(1.2); cursor: pointer; }

    </style>
</head>
<body>

<div class="checklist-container">
    <div style="margin-bottom: 10px;">
        <a href="/pages/checklist.html" style="text-decoration: none; color: #666;">&lt; è¿”å›å¤§å…</a>
    </div>

    <div class="control-panel">
        <div>
            <h2 style="margin:0; font-size: 20px;">ğŸ›¡ï¸ è£èª‰å‹‹ç« å‹¾å‹¾å†Œ (å®šåˆ¶ç‰ˆ)</h2>
            <p style="margin:5px 0 0 0; font-size: 12px; color: #666;">
                æ›´æ–°å†…å®¹ï¼šä¼˜åŒ–PVPæè¿°ã€å—æ°´-1æ··åˆæ¨¡å¼å¸ƒå±€è°ƒæ•´ã€‚
            </p>
        </div>
        <div>
            <button class="btn btn-danger" onclick="resetAll()">é‡ç½®æ•°æ®</button>
            <button class="btn" onclick="addAccount()">+ æ–°å¢è´¦å·</button>
        </div>
    </div>

    <div class="table-responsive">
        <table class="matrix-table" id="main-table">
            </table>
    </div>
</div>

<script>
    // === é…ç½®æ•°æ® ===
    const DATA_CONFIG = [
        {
            id: "by", name: "åŒ—å²³ä¹‹å‹‡ (å…æ­»)", mode: 'chain',
            levels: [
                { id: "0", ui_mode: "count", name: "åŒ—å²³ä¹‹å‹‡", attr: "8åˆ†é’Ÿå†…å—è‡´å‘½æ”»å‡»æ—¶ï¼Œè¿›å…¥æ— æ•ŒçŠ¶æ€ï¼ŒæŒç»­2.5ç§’ï¼Œå†·å´660ç§’", desc: "å‘¨å…­21:30 æ™¨æ›¦è‰åŸBOSS", c1_max: 5, c2_target: 37, c3_target: 200 },
                { id: "1", ui_mode: "check", name: "åŒ—å²³-1", attr: "åŒæ—¶è·å¾—10%æš´å‡»ä¼¤å®³æå‡ï¼ŒæŒç»­15ç§’", desc: "å·¡å¯¨å±±è´¼*600 æˆ– å°é¬¼æ€ª*250", c1_max: 600, c2_target: 80, c3_target: 5000 },
                { id: "2", ui_mode: "check", name: "åŒ—å²³-2", attr: "åŒæ—¶è·å¾—5%ç¥åœ£ä¸€å‡»ä¼¤å®³æå‡ï¼ŒæŒç»­15ç§’", desc: "çŸ¿å·¥æ¶éœ¸*50 æˆ– å§‹ç¥–å¸è¡€é¬¼*50", c1_max: 50, c2_target: 85, c3_target: 6000 },
                { id: "3", ui_mode: "check", name: "åŒ—å²³-3", attr: "åŒæ—¶è·å¾—2.5%è¿å‡»ç‡æå‡ï¼ŒæŒç»­15ç§’", desc: "æ¬ç –å·¥äºº*100 æˆ– æš´æ°‘*300", c1_max: 100, c2_target: 90, c3_target: 7000 }
            ]
        },
        {
            id: "xf", name: "è¥¿é£ä¹‹ä¿¡ (å…æ­»)", mode: 'chain',
            levels: [
                { id: "0", ui_mode: "count", name: "è¥¿é£ä¹‹ä¿¡", attr: "8åˆ†é’Ÿå†…å—è‡´å‘½æ”»å‡»æ—¶ï¼Œè¿›å…¥æ— æ•ŒçŠ¶æ€ï¼ŒæŒç»­2.5ç§’ï¼Œå†·å´660ç§’", desc: "å‘¨å…­22:00 é¸£æ²™è’æ¼ BOSS", c1_max: 5, c2_target: 44, c3_target: 500 },
                { id: "1", ui_mode: "count", name: "è¥¿é£-1", attr: "åŒæ—¶è·å¾—50%å‡ä¼¤ï¼ŒæŒç»­15ç§’", desc: "æŠ•æ¯’å¥¸ç»†*50", c1_max: 50, c2_target: 100, c3_target: 5500 },
                { id: "2", ui_mode: "check", name: "è¥¿é£-2", attr: "åŒæ—¶è·å¾—3æ¬¡è´Ÿé¢çŠ¶æ€å…ç–«ï¼ŒæŒç»­15ç§’", desc: "æ—è´¼*3000 æˆ– é»‘é£å¯¨æµå¯‡*800", c1_max: 3000, c2_target: 105, c3_target: 6500 },
                { id: "3", ui_mode: "check", name: "è¥¿é£-3", attr: "åŒæ—¶è·å¾—15%ç”Ÿå‘½ä¸Šé™æå‡ï¼ŒæŒç»­15ç§’", desc: "ä¿®ç½—é«˜æ‰‹*50 æˆ– é»‘æ—‹é£*50", c1_max: 50, c2_target: 110, c3_target: 7500 }
            ]
        },
        {
            id: "dm", name: "ä¸œæœ¨ä¹‹æ¯… (å¿…æš´)", mode: 'chain',
            levels: [
                { id: "0", ui_mode: "check", name: "ä¸œæœ¨ä¹‹æ¯…", attr: "æŸæ¬¡æ”»å‡»åï¼Œä¸‹æ¬¡æ”»å‡»å¿…å®šæš´å‡»ï¼Œå†·å´500ç§’", desc: "æ— ç‰¹æ®Šæ‰“æ€ªæ¡ä»¶ (ç›´æ¥è¾¾æˆ)", c1_max: 0, c2_target: 51, c3_target: 1000 },
                { id: "1", ui_mode: "count", name: "ä¸œæœ¨-1", attr: "åŒæ—¶è·å¾—15%ç”Ÿå‘½ä¸Šé™æå‡ï¼ŒæŒç»­15ç§’", desc: "PVPçº¿æ™¨æ›¦è‰åŸæ—¥å¸¸*10", c1_max: 10, c2_target: 120, c3_target: 6000 },
                { id: "2", ui_mode: "count", name: "ä¸œæœ¨-2", attr: "åŒæ—¶è·å¾—5æ¬¡å…ç–«ï¼ŒæŒç»­15ç§’", desc: "æ—¥å¸¸-æœ‰é£è‡ªå—*10", c1_max: 10, c2_target: 125, c3_target: 7000 },
                { id: "3", ui_mode: "check", name: "ä¸œæœ¨-3", attr: "åŒæ—¶è·å¾—5%æš´å‡»ç‡ï¼Œ7.5%æš´å‡»ä¼¤å®³æå‡ï¼ŒæŒç»­15ç§’", desc: "æµ·å¯‡*11100 æˆ– å—ç–†å¥¸ç»†*200", c1_max: 11100, c2_target: 130, c3_target: 8000 }
            ]
        },
        {
            id: "ns", name: "å—æ°´ä¹‹æ™º (å¿…æš´)", mode: 'chain',
            levels: [
                { id: "0", ui_mode: "check", name: "å—æ°´ä¹‹æ™º", attr: "æŸæ¬¡æ”»å‡»åï¼Œä¸‹æ¬¡æ”»å‡»å¿…å®šæš´å‡»ï¼Œå†·å´500ç§’", desc: "æ— ç‰¹æ®Šæ‰“æ€ªæ¡ä»¶ (ç›´æ¥è¾¾æˆ)", c1_max: 0, c2_target: 58, c3_target: 2000 },
                { 
                    id: "1", 
                    ui_mode: "hybrid", 
                    name: "å—æ°´-1", 
                    attr: "æš´å‡»æ¬¡æ•°+1ï¼ŒæŒç»­15ç§’", 
                    desc: "æµ·å¯‡*44400 / æ—¥å¸¸*10", 
                    c1_max: 10, 
                    // é…ç½®ç‰¹å®šæ ‡ç­¾
                    c1_alt_label: "æµ·å¯‡*44400", 
                    c1_counter_label: "PVPçº¿å—ç–†æ—¥å¸¸*10",
                    c2_target: 140, 
                    c3_target: 6500 
                },
                { id: "2", ui_mode: "check", name: "å—æ°´-2", attr: "æš´å‡»ä¼¤å®³æå‡10%ï¼ŒæŒç»­15ç§’", desc: "ç²¾è‹±æ²™ç›—*250", c1_max: 250, c2_target: 145, c3_target: 7500 },
                { id: "3", ui_mode: "count", name: "å—æ°´-3", attr: "æš´å‡»æ¬¡æ•°+1ï¼Œæš´å‡»ä¼¤å®³æå‡10%ï¼ŒæŒç»­15ç§’", desc: "æ¶é¾™*50", c1_max: 50, c2_target: 150, c3_target: 8500 }
            ]
        },
        {
            id: "qh", name: "è°¦å’Œå¾½è®°", mode: 'collection',
            levels: [
                { id: "mon", ui_mode: "count", name: "è°¦å’Œ-å‘¨ä¸€", attr: "å‡»ä¸­ç›®æ ‡æ—¶ï¼Œå¸æ”¶ç›®æ ‡10%æŠ€èƒ½é—ªé¿ï¼ŒæŒç»­10ç§’ï¼Œå†·å´240ç§’", desc: "å‡»æ€å‘¨ä¸€ 21:00 BOSS", c1_max: 5, c2_target: 30, c3_target: 100 },
                { id: "tue", ui_mode: "count", name: "è°¦å’Œ-å‘¨äºŒ", attr: "åŒä¸Š", desc: "å‡»æ€å‘¨äºŒ 21:00 BOSS", c1_max: 5, c2_target: 30, c3_target: 100 },
                { id: "wed", ui_mode: "count", name: "è°¦å’Œ-å‘¨ä¸‰", attr: "åŒä¸Š", desc: "å‡»æ€å‘¨ä¸‰ 21:00 BOSS", c1_max: 5, c2_target: 30, c3_target: 100 },
                { id: "thu", ui_mode: "count", name: "è°¦å’Œ-å‘¨å››", attr: "åŒä¸Š", desc: "å‡»æ€å‘¨å›› 21:00 BOSS", c1_max: 5, c2_target: 30, c3_target: 100 },
                { id: "fri", ui_mode: "count", name: "è°¦å’Œ-å‘¨äº”", attr: "åŒä¸Š", desc: "å‡»æ€å‘¨äº” 21:00 BOSS", c1_max: 5, c2_target: 30, c3_target: 100 },
                { id: "sat", ui_mode: "count", name: "è°¦å’Œ-å‘¨å…­", attr: "åŒä¸Š", desc: "å‡»æ€å‘¨å…­ 21:00 BOSS", c1_max: 5, c2_target: 30, c3_target: 100 },
                { id: "sun", ui_mode: "count", name: "è°¦å’Œ-å‘¨æ—¥", attr: "åŒä¸Š", desc: "å‡»æ€å‘¨æ—¥ 21:00 BOSS", c1_max: 5, c2_target: 30, c3_target: 100 }
            ]
        }
    ];

    const STORAGE_KEY = 'medal_final_v4_data';
    let accounts = [];

    document.addEventListener('DOMContentLoaded', () => {
        loadData();
        if (accounts.length === 0) addAccount('ä¸»è´¦å·');
        else render();
    });

    function loadData() {
        try {
            const d = localStorage.getItem(STORAGE_KEY);
            accounts = d ? JSON.parse(d) : [];
        } catch(e) { accounts = []; }
    }

    function saveData() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(accounts));
        render();
    }

    function addAccount(name = "æ–°è´¦å·") {
        accounts.push({
            id: Date.now().toString(),
            name: name,
            global_pvp: 0,
            global_kills: 0,
            tasks: {}
        });
        saveData();
    }

    function removeAccount(id) {
        if(confirm("ç¡®å®šåˆ é™¤è¯¥è´¦å·ï¼Ÿ")) {
            accounts = accounts.filter(a => a.id !== id);
            saveData();
        }
    }

    function updateAccountName(id, val) {
        const acc = accounts.find(a => a.id === id);
        if(acc) { acc.name = val; localStorage.setItem(STORAGE_KEY, JSON.stringify(accounts)); }
    }

    function updateCount(accId, type, key, delta, maxLimit) {
        const acc = accounts.find(a => a.id === accId);
        if(!acc) return;

        if (type === 'global_pvp') {
            let val = (acc.global_pvp || 0) + delta;
            acc.global_pvp = Math.max(0, val);
        } else if (type === 'global_kills') {
            let val = (acc.global_kills || 0) + delta;
            acc.global_kills = Math.max(0, val);
        } else {
            if (!acc.tasks) acc.tasks = {};
            let val = (acc.tasks[key] || 0) + delta;
            if (val < 0) val = 0;
            if (maxLimit && val > maxLimit) val = maxLimit;
            acc.tasks[key] = val;
        }
        saveData();
    }

    function toggleTaskCheckbox(accId, key, maxVal) {
        const acc = accounts.find(a => a.id === accId);
        if(!acc) return;
        if (!acc.tasks) acc.tasks = {};
        const current = acc.tasks[key] || 0;
        acc.tasks[key] = (current >= maxVal) ? 0 : maxVal;
        saveData();
    }

    function toggleHybridCheck(accId, key) {
        const acc = accounts.find(a => a.id === accId);
        if(!acc) return;
        if (!acc.tasks) acc.tasks = {};
        const altKey = key + "_alt";
        acc.tasks[altKey] = !acc.tasks[altKey];
        saveData();
    }

    function setInputCount(accId, type, key, valStr) {
        const acc = accounts.find(a => a.id === accId);
        if(!acc) return;
        let val = parseInt(valStr);
        if(isNaN(val)) val = 0;
        if (type === 'global_pvp') acc.global_pvp = val;
        else if (type === 'global_kills') acc.global_kills = val;
        else {
            if (!acc.tasks) acc.tasks = {};
            acc.tasks[key] = val;
        }
        saveData();
    }

    function toggleKillCheckbox(accId, targetVal) {
        const acc = accounts.find(a => a.id === accId);
        if(!acc) return;
        const currentKills = acc.global_kills || 0;
        acc.global_kills = (currentKills >= targetVal) ? Math.max(0, targetVal - 1) : targetVal;
        saveData();
    }

    function resetAll() {
        if(confirm("æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼Ÿ")) {
            localStorage.removeItem(STORAGE_KEY);
            location.reload();
        }
    }

    function render() {
        const table = document.getElementById('main-table');
        let html = `<thead><tr><th style="z-index:50">å‹‹ç« è¯¦æƒ…ä¸ä»»åŠ¡</th>`;
        
        accounts.forEach(acc => {
            html += `<th>
                <div style="display:flex; flex-direction:column; gap:4px;">
                    <input value="${acc.name}" onchange="updateAccountName('${acc.id}', this.value)" 
                           style="text-align:center; font-weight:bold; width:80px; border:none; background:transparent; border-bottom:1px solid #ccc;">
                    <div style="display:flex; justify-content:space-between; font-size:10px; color:#666;">
                        <span>PVP:${acc.global_pvp||0}</span>
                        <span>æ€:${acc.global_kills||0}</span>
                    </div>
                    <button class="btn-danger" onclick="removeAccount('${acc.id}')">åˆ é™¤</button>
                </div>
            </th>`;
        });
        html += `</tr></thead><tbody>`;

        DATA_CONFIG.forEach(group => {
            html += `<tr class="group-header"><td colspan="${accounts.length + 1}">${group.name}</td></tr>`;
            
            group.levels.forEach((lvl, idx) => {
                const taskKey = `${group.id}_${lvl.id}`;
                
                html += `<tr>
                    <td>
                        <span class="task-name">${lvl.name}</span>
                        <span class="attr-badge ${lvl.attr==='åŒä¸Š'?'dimmed':''}">${lvl.attr}</span>
                        <span class="task-desc">ä»»åŠ¡: ${lvl.desc}</span>
                        <span class="task-meta">è¦æ±‚: PVPâ‰¥${lvl.c2_target} / æ€æ•Œâ‰¥${lvl.c3_target}</span>
                    </td>`;
                
                accounts.forEach(acc => {
                    const c1_val = (acc.tasks && acc.tasks[taskKey]) || 0;
                    const c1_alt_checked = (acc.tasks && acc.tasks[taskKey + "_alt"]) || false;
                    const c2_val = acc.global_pvp || 0;
                    const c3_val = acc.global_kills || 0;

                    let isC1Done = false;
                    if (lvl.ui_mode === 'hybrid') isC1Done = (c1_val >= lvl.c1_max) || c1_alt_checked;
                    else isC1Done = (lvl.c1_max === 0) || (c1_val >= lvl.c1_max);

                    const isC2Done = c2_val >= lvl.c2_target;
                    const isC3Done = c3_val >= lvl.c3_target;
                    const isTaskDone = isC1Done && isC2Done && isC3Done;
                    
                    let isChainActive = true;
                    if (group.mode === 'collection') {
                        isChainActive = group.levels.every(l => {
                             const k = `${group.id}_${l.id}`;
                             const t1 = ((acc.tasks && acc.tasks[k])||0) >= l.c1_max;
                             const t2 = (acc.global_pvp||0) >= l.c2_target;
                             const t3 = (acc.global_kills||0) >= l.c3_target;
                             return t1 && t2 && t3;
                        });
                    } else {
                        if (idx > 0) {
                            for(let i=0; i<idx; i++) {
                                const prevLvl = group.levels[i];
                                const prevKey = `${group.id}_${prevLvl.id}`;
                                let p1 = false;
                                if (prevLvl.ui_mode === 'hybrid') {
                                    const val = (acc.tasks && acc.tasks[prevKey]) || 0;
                                    const alt = (acc.tasks && acc.tasks[prevKey+"_alt"]) || false;
                                    p1 = (val >= prevLvl.c1_max) || alt;
                                } else {
                                    const val = (acc.tasks && acc.tasks[prevKey]) || 0;
                                    p1 = (prevLvl.c1_max === 0) || (val >= prevLvl.c1_max);
                                }
                                const p2Ok = c2_val >= prevLvl.c2_target;
                                const p3Ok = c3_val >= prevLvl.c3_target;
                                if (!(p1 && p2Ok && p3Ok)) { isChainActive = false; break; }
                            }
                        }
                    }

                    let rowStyle = isTaskDone ? (isChainActive ? "row-active" : "row-pending") : "";

                    html += `<td class="${rowStyle}">
                        <div class="cell-section">
                            <div class="cell-label">${lvl.desc}</div>
                            
                            ${lvl.c1_max === 0 ? '<div style="text-align:center; font-size:11px; color:#aaa;">(ç›´æ¥è¾¾æˆ)</div>' : ''}

                            ${lvl.c1_max > 0 && lvl.ui_mode === 'count' ? `
                                <div class="counter-wrapper">
                                    <button class="count-btn" onclick="updateCount('${acc.id}', 'local', '${taskKey}', -1, ${lvl.c1_max})">-</button>
                                    <input class="count-input ${isC1Done?'status-done':''}" value="${c1_val}" onchange="setInputCount('${acc.id}', 'local', '${taskKey}', this.value)">
                                    <button class="count-btn" onclick="updateCount('${acc.id}', 'local', '${taskKey}', 1, ${lvl.c1_max})">+</button>
                                </div>
                                <div style="text-align:center;font-size:10px;color:#999;">ç›®æ ‡: ${lvl.c1_max}</div>
                            ` : ''}

                            ${lvl.c1_max > 0 && lvl.ui_mode === 'check' ? `
                                <div class="big-checkbox-wrapper" onclick="toggleTaskCheckbox('${acc.id}', '${taskKey}', ${lvl.c1_max})">
                                    <input type="checkbox" ${isC1Done?'checked':''} style="pointer-events:none;"> 
                                    <span class="big-checkbox-text ${isC1Done?'done-text':''}">
                                        ${isC1Done ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'}
                                    </span>
                                </div>
                            ` : ''}

                            ${lvl.ui_mode === 'hybrid' ? `
                                <div class="cell-label">${lvl.c1_alt_label}</div>
                                <div class="big-checkbox-wrapper" onclick="toggleHybridCheck('${acc.id}', '${taskKey}')">
                                    <input type="checkbox" ${c1_alt_checked?'checked':''} style="pointer-events:none;"> 
                                    <span class="big-checkbox-text ${c1_alt_checked?'done-text':''}">
                                        ${c1_alt_checked ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'}
                                    </span>
                                </div>
                                
                                <div class="or-divider">- æˆ– -</div>

                                <div class="cell-label">${lvl.c1_counter_label}</div>
                                <div class="counter-wrapper">
                                    <button class="count-btn" onclick="updateCount('${acc.id}', 'local', '${taskKey}', -1, ${lvl.c1_max})">-</button>
                                    <input class="count-input ${c1_val>=lvl.c1_max?'status-done':''}" value="${c1_val}" onchange="setInputCount('${acc.id}', 'local', '${taskKey}', this.value)">
                                    <button class="count-btn" onclick="updateCount('${acc.id}', 'local', '${taskKey}', 1, ${lvl.c1_max})">+</button>
                                </div>
                            ` : ''}

                        </div>
                        <div class="divider"></div>
                        <div class="cell-section">
                            <div class="cell-label">PVPæ—¥å¸¸ (éœ€${lvl.c2_target}æ¬¡)</div>
                            <div class="counter-wrapper">
                                <button class="count-btn" onclick="updateCount('${acc.id}', 'global_pvp', null, -1)">-</button>
                                <input class="count-input ${isC2Done?'status-done':''}" value="${c2_val}" onchange="setInputCount('${acc.id}', 'global_pvp', null, this.value)">
                                <button class="count-btn" onclick="updateCount('${acc.id}', 'global_pvp', null, 1)">+</button>
                            </div>
                        </div>
                        <div class="divider"></div>
                        <div class="cell-section">
                            <div class="cell-label">æ€æ•Œ (éœ€${lvl.c3_target})</div>
                            <div style="display:flex; align-items:center; justify-content:center; gap:4px;">
                                <div class="checkbox-area" onclick="toggleKillCheckbox('${acc.id}', ${lvl.c3_target})">
                                    <input type="checkbox" ${isC3Done?'checked':''} style="pointer-events:none;">
                                    <span style="font-size:12px; ${isC3Done?'font-weight:bold;color:#2e7d32':''}">è¾¾æ ‡</span>
                                </div>
                                <input class="count-input small-input" value="${c3_val}" onchange="setInputCount('${acc.id}', 'global_kills', null, this.value)" title="è°ƒæ•´">
                            </div>
                        </div>
                    </td>`;
                });
                html += `</tr>`;
            });
        });
        html += `</tbody>`;
        table.innerHTML = html;
    }
</script>
</body>
</html>